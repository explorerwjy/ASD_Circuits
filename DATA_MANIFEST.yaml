# DATA_MANIFEST.yaml - Documents all data files used by the GENCIC project
#
# This file documents data dependencies that are NOT tracked in git.
# For config-driven paths, see also config/config.yaml.

files:
  # ===== Allen Brain Atlas ISH Data =====
  /mnt/data0/AllenBrainAtlas/ISH/:
    description: "Structure-unionized expression energy for all Allen Mouse Brain ISH experiments. One CSV per experiment (~26,078 files)."
    format: "CSV files, one per section_data_set_id (e.g., 100141219.csv)"
    key_fields:
      expression_energy: "Unionized expression energy per structure"
      structure_id: "Allen structure ID"
      section_data_set_id: "ISH experiment ID (filename)"
    source: "Allen Brain Atlas API (http://api.brain-map.org/api/v2/data/StructureUnionize/)"
    size_approx: "~5 GB total (26K files)"
    notes: "Downloaded by notebooks_mouse_str/01.Download_ISH_data.ipynb. Previously stored at dat/allen-mouse-exp/allen-mouse-brain-altas-str-unionzed/"
    config_key: "data_files.ish_expression_dir"

  dat/allen-mouse-exp/:
    description: "Allen Brain Atlas metadata files — ISH experiment lists, gene catalogs, homology mappings, structure metadata"
    format: "CSV, JSON, pickle"
    key_fields:
      All_Mouse_Brain_ISH_experiments.csv: "All ISH experiments with gene_acronym, genes_entrez_id, section_data_set_id"
      All_Mouse_Brain_ISH_genes.csv: "Gene catalog with Entrez IDs"
      All_Mouse_Brain_Genes.csv: "Gene metadata with homologene IDs"
      human2mouse.0420.json: "Human Entrez → Mouse gene mapping (via homology)"
      mouse2sectionID.0420.json: "Mouse Entrez → Allen section IDs + human orthologs"
      Selected_213_STRs.Meta.csv: "Metadata for the 213 selected brain structures"
      Structures.txt: "List of 213 selected structure names"
    source: "Allen Brain Atlas API + MGI/JAX homology (downloaded by notebook 01)"
    size_approx: "~50 MB"
    config_key: "data_files.allen_metadata_dir"

  dat/allen-mouse-exp/Jon_ExpMat.raw.csv:
    description: "Jon's raw expression energy matrix — arithmetic mean of ISH expression energy across sections per gene"
    format: "CSV (index=ROW, 17,208 genes × 213 structures)"
    key_fields:
      ROW: "Human Entrez gene ID"
      columns: "213 brain structure names"
      values: "Arithmetic mean of raw expression_energy across ISH experiments"
    source: "Jon's ISH processing pipeline (R). Copied from /home/jw3514/Work/ASD_Circuits/scripts/dat/Jon_data/expression_energy-human-connectome_struc.csv"
    size_approx: "33 MB"
    config_key: "data_files.jon_exp_raw"
    notes: "Aggregation method: mean(expression_energy) per gene, NOT log-transformed. Jon's ortholog mapping (17,208 human genes, slightly different from JW's 17,196). See docs/Jon_Exp_Mat.md."

  dat/allen-mouse-exp/Jon_ExpMat.log2.qn.csv:
    description: "Jon's log2+QN expression matrix — log2(1+raw) then R quantile normalization. THE input for the Z2 pipeline."
    format: "CSV (index=ROW, 17,208 genes × 213 structures)"
    key_fields:
      ROW: "Human Entrez gene ID"
      columns: "213 brain structure names"
      values: "R quantile-normalized log2(1+raw) expression"
    source: "Jon's R pipeline: log2(1+raw) → preprocessCore::normalize.quantiles. Copied from /home/jw3514/Work/ASD_Circuits/scripts/dat/Jon_data/expression_energy-human-connectome_struc-log2-qn.csv"
    size_approx: "62 MB"
    config_key: "data_files.jon_exp_log2_qn"
    notes: "Python QN differs from R QN (r=0.993, different tie-breaking). Python QN shifts CCS local peak away from size 46, so we use Jon's R QN. See notebook_validation/Validate_ISH_Z2_Pipeline."

  dat/allen-mouse-exp/ExpMatch_Legacy/:
    description: "Legacy expression match files — per-gene lists of expression-matched genes (10K samples w/ replacement)"
    format: "Plain text CSV, one Entrez gene ID per line (17,189 files)"
    key_fields:
      filename: "{entrez_id}.csv"
      content: "10,000 matched gene IDs sampled with replacement from ±5% quantile window"
    source: "Generated by legacy pipeline. Symlink to /home/jw3514/Work/ASD_Circuits/dat/genes/ExpMatch_RootExp_uniform_kernal/"
    size_approx: "~1.5 GB total"
    config_key: "data_files.legacy_match_dir"
    notes: "Z2 uses ALL entries including duplicates for frequency-weighted mean/std. Fresh matches (seed=42) give different results (top 46 overlap: 41/46, CCS peak shifts). Must use legacy files for exact reproduction."

  dat/HOM_MouseHumanSequence.rpt:
    description: "MGI Human-Mouse gene homology report"
    format: "TSV (tab-delimited)"
    key_fields:
      DB_Class_Key: "Homology group ID"
      Symbol: "Gene symbol"
      EntrezGene_ID: "Entrez gene ID"
      NCBI_Taxon_ID: "9606=human, 10090=mouse"
    source: "MGI/JAX (https://www.informatics.jax.org/downloads/reports/HOM_MouseHumanSequence.rpt)"
    size_approx: "~5 MB"

  # ===== Expression Bias Matrices =====
  dat/allen-mouse-exp/ExpMatchFeatures.csv:
    description: "Root expression level and quantile rank per gene, used for expression matching in Z2"
    format: "CSV (index=Genes)"
    key_fields:
      Genes: "Human Entrez gene ID"
      EXP: "Mean QN expression across all 213 structures"
      Rank: "Rank by expression level (1=lowest)"
      quantile: "Quantile position (0-1)"
    source: "Generated by notebook 02 from Jon's log2+QN matrix"
    size_approx: "~500 KB"
    notes: "17,208 genes"

  dat/BiasMatrices/AllenMouseBrain_Z1.parquet:
    description: "Z1 z-score matrix — per-gene z-score of Jon's log2+QN expression across 213 structures"
    format: "Parquet"
    key_fields:
      index: "Human Entrez gene IDs (int64)"
      columns: "213 brain structure names"
    source: "Generated by notebook 02 from Jon's log2+QN expression"
    size_approx: "33 MB"
    notes: "17,208 genes × 213 structures. Bit-exact match with legacy Z1 (AllenMouse_z1_mat.0511.csv) on 17,180 common genes."

  dat/BiasMatrices/AllenMouseBrain_Z2bias.parquet:
    description: "Z2 expression-matched z-score matrix. Controls for baseline expression level."
    format: "Parquet (also saved as .csv.gz)"
    key_fields:
      index: "Human Entrez gene IDs (int64)"
      columns: "213 brain structure names"
    source: "Generated by scripts/script_compute_Z2.py (called from notebook 02)"
    size_approx: "35 MB"
    config_key: "analysis_types.STR_ISH.expr_matrix"
    notes: "17,208 genes × 213 structures. Uses Jon's R QN + legacy match files (10K samples w/ replacement, frequency-weighted). Bit-exact CCS profile with local peak at size 46. See notebook_validation/Validate_ISH_Z2_Pipeline."

  dat/BiasMatrices/Cluster_Z2Mat_ISHMatch.z1clip3.parquet:
    description: "Cell type Z2 expression bias matrix (genes x cell type clusters)"
    format: "Parquet"
    key_fields:
      index: "Entrez gene IDs"
      columns: "Cell type cluster IDs"
    source: "Generated from Allen Brain Cell Atlas single-cell data"
    size_approx: "~30 MB"
    config_key: "analysis_types.CT_Z2.expr_matrix"

  dat/BiasMatrices/MouseBrain_MERIFHbias.parquet:
    description: "MERFISH spatial transcriptomics bias matrix"
    format: "Parquet"
    source: "Generated from MERFISH spatial data"
    size_approx: "~20 MB"

  # ===== Connectome Data =====
  dat/allen-mouse-conn/ConnectomeScoringMat/:
    description: "Connectivity scoring matrices for circuit analysis"
    format: "CSV/Parquet"
    key_fields:
      WeightMat: "Connection weight matrix (213x213)"
      InfoMat: "Shannon information matrix (213x213)"
    source: "Allen Mouse Brain Connectivity Atlas (processed)"
    size_approx: "~10 MB"
    notes: "Ipsilateral connections only"

  # ===== Genetics / Gene Weights =====
  dat/Genetics/GeneWeights/:
    description: "Gene weight files for all gene sets analyzed"
    format: "CSV (.gw and .csv), EntrezID,weight (no header for .gw)"
    key_fields:
      ASD_All.gw: "61 ASD genes (main analysis, copy of Spark_Meta_EWS.GeneWeight.v2.csv)"
      Spark_Meta_160.GeneWeight.csv: "153 genes (expanded SPARK gene set)"
    source: "Derived from SPARK/ASC exome sequencing studies"
    size_approx: "~1 MB total"
    notes: "All gene sets listed in config/config.yaml under gene_sets"

  dat/Genetics/SPARK/:
    description: "SPARK/ASC de novo variant tables from Zhou et al. 2022"
    format: "TSV (tab-separated)"
    key_fields:
      IID: "Subject ID"
      HGNC: "Gene symbol"
      GeneEff: "Functional effect (frameshift, missense, etc.)"
      REVEL: "REVEL pathogenicity score (for missense)"
    source: "SPARK Consortium (Zhou et al. 2022, Nature Genetics)"
    files:
      ASD_Discov_DNVs.txt: "Discovery cohort de novo variants (31,004 rows)"
      ASD_Rep_DNVs.txt: "Replication cohort de novo variants (770 rows)"
    size_approx: "~8 MB total"
    notes: "Used by notebooks 04, 06, 11 for gene weight computation and mutation analysis"

  dat/Genetics/TabS_DenovoWEST_Stage1+2.xlsx:
    description: "DenovoWEST meta-analysis results, Stage 1+2 combined"
    format: "Excel, sheet 'TopDnEnrich', skip 2 header rows"
    key_fields:
      HGNC: "Gene symbol"
      pDenovoWEST_Meta: "Meta-analysis p-value (exome-wide sig: <=1.3e-6)"
    source: "Zhou et al. 2022 (Nature Genetics), Supplementary Table S7"
    size_approx: "~100 KB"
    notes: "159 genes total, 61 at exome-wide significance. Used by notebook 11"

  dat/Genetics/GeneWeights/GeneProb_LGD_Dmis.csv:
    description: "Per-gene mutation probabilities for sibling null model"
    format: "CSV"
    key_fields:
      gene: "Gene symbol"
      prob: "Mutation probability"
    source: "Computed from mutation rate models"
    size_approx: "~500 KB"
    notes: "15,402 genes"

  # ===== Unionize Bias Results =====
  dat/Unionize_bias/:
    description: "Pre-computed bias scores with p-values and FDR correction"
    format: "CSV"
    key_fields:
      EFFECT: "Weighted average expression bias"
      Rank: "Structure rank by bias"
      Pvalue: "Sibling null p-value"
      qvalues: "FDR-corrected p-values"
      REGION: "Major brain division"
    source: "Generated by Snakefile.bias pipeline"
    size_approx: "~5 MB total"
    notes: "Key file: Spark_Meta_EWS.Z2.bias.FDR.csv (main ASD results)"

  # ===== Results (Generated) =====
  results/:
    description: "All pipeline outputs — null distributions, circuit search results, bootstrap, sibling analysis"
    format: "Various (parquet, CSV, NPZ)"
    source: "Generated by Snakemake pipelines"
    size_approx: "~10 GB"
    notes: "Not tracked in git. Subdirectories: STR_ISH/, CT_Z2/, Sibling_bias/, Bootstrap/"
